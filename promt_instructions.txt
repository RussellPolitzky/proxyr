# Proxyr Package Requirements

## Core Functionality

### `with_proxy` Function
-   **Purpose**: Execute a block of code with temporary proxy environment variables set.
-   **Usage**: `with_proxy({ ... })`
-   **Scope**:
    -   Sets `http_proxy` and `https_proxy` environment variables for the R session while the code block runs.
    -   Restores ambient proxy settings (or unsets them) immediately after execution.
    -   **Robustness**: Must use a `try-finally` (e.g., `on.exit`) approach to ensure restoration even if errors occur.
-   **Configuration**:
    -   Should support a default proxy URL configuration to avoid repeating arguments.
    -   **Windows Fallback**: If running on Windows and no proxy is configured, it should automatically use the Windows system proxy settings.

## Credential Management

-   **Storage**: Store proxy username and password in the Windows Credential Manager using the `keyring` package.
-   **Functions**:
    -   Allow users to capture (set) proxy details.
    -   Allow users to remove proxy details.
    -   Allow users to list stored proxy details.
-   **Integration**: `with_proxy` should automatically retrieve and URL-encode credentials for the target proxy if authentication is required.
-   **Security**: The function to retrieve credentials (`get_proxy_credentials`) must NOT be accessible to the end user (internal only) to minimize security risks.

## Documentation

-   **Roxygen**: All functions must have usage examples in their documentation.
-   **Vignette**: A vignette explaining package usage with simple examples must be included.
-   **Format**: Generate PDF reference documentation and an HTML vignette.

## Quality Assurance & Build

-   **Testing**:
    -   Use `testthat` for unit tests.
    -   Include tests using an open proxy server (where feasible) or mocks.
-   **Build**:
    -   Build using `devtools`.
    -   Must comply with CRAN policies.
-   **Version Control**: Hosted in a Git repository (GitHub).